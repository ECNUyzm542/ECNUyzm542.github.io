<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
 <script src="https://cdn.staticfile.org/echarts/4.3.0/echarts.min.js"></script>
</head>
<style type="text/css">
    
    img.head{
        height: 200px;
        width: 200px;
    }
        img.skill{
        width: 100px;
        height:100px; 
    }
        textarea.skill{
        width: 500px;
        height:150px;
        color: white;
        background: transparent;
        border-style: none;
    }
        img.hero{
        width: 100px;
        height: 100px;
    }
    #canvas{
    width:100%;
    height:100%;
    position: absolute;
    top: 0%;
    z-index: -1;
    background:#000;
    margin:0px;
    width:100%;
    height:100%;
    
}
</style>
<body>
    <canvas id="canvas"></canvas>
    <div style="z-index: 3;">
    <table><td>
<img class="head" id="head">
            <table><tr>
<td><a onmouseover="isHidden('skill1')" onmouseout="isHidden('skill1')"><img src="./number/1.png" class="skill" border="0"></a></td>
<td><a onmouseover="isHidden('skill2')" onmouseout="isHidden('skill2')"><img src="./number/2.png" class="skill" border="0"></a></td>
<td><a onmouseover="isHidden('skill3')" onmouseout="isHidden('skill3')"><img src="./number/3.png" class="skill" border="0"></a></td>
<td><a onmouseover="isHidden('skill4')" onmouseout="isHidden('skill4')"><img src="./number/4.png" class="skill" border="0"></a></td>
</tr></table>
 </td>
 <td>
 <div id="herotable">
        <table><tr>
<td><button type="button" value="1" onclick="show(this)" id="1"><img src="./路飞.jpg" class="hero" border="0"><br></button></td>
<td><button type="button" value="2" onclick="show(this)" id="2"><img src="./索隆.jpg" class="hero" border="0"><br></button></td>
<td><button type="button" value="3" onclick="show(this)" id="3"><img src="./山治.jpg" class="hero" border="0"><br></button></td>
<td><button type="button" value="4" onclick="show(this)" id="4"><img src="./罗宾.jpg" class="hero" border="0"><br></button></td></tr><tr>
<td><button type="button" value="5" onclick="show(this)" id="5"><img src="./娜美.jpg" class="hero" border="0"><br></button></td>
<td><button type="button" value="6" onclick="show(this)" id="6"><img src="./乔巴.jpg" class="hero" border="0"><br></button></td>
<td><button type="button" value="7" onclick="show(this)" id="7"><img src="./乌索普.jpg" class="hero" border="0"><br></button></td>
<td><button type="button" value="8" onclick="show(this)" id="8"><img src="./布鲁克.jpg" class="hero" border="0"><br></button></td></tr><tr>
<td><button type="button" value="9" onclick="show(this)" id="9"><img src="./弗兰奇.jpg" class="hero" border="0"><br></button></td>
<td><button type="button" value="10" onclick="show(this)" id="10"><img src="./女帝.jpg" class="hero" border="0"><br></button></td>
<td><button type="button" value="11" onclick="show(this)" id="11"><img src="./鹰眼.jpg" class="hero" border="0"><br></button></td>
<td><button type="button" value="12" onclick="show(this)" id="12"><img src="./熊.jpg" class="hero" border="0"><br></button></td></tr><tr>
<td><button type="button" value="13" onclick="show(this)" id="13"><img src="./明哥.jpg" class="hero" border="0"><br></button></td>
<td><button type="button" value="14" onclick="show(this)" id="14"><img src="./head/0.jpg" class="hero" border="0"><br></button></td>
<td><button type="button" value="15" onclick="show(this)" id="15"><img src="./head/0.jpg" class="hero" border="0"><br></button></td>
<td><button type="button" value="16" onclick="show(this)" id="16"><img src="./head/0.jpg" class="hero" border="0"><br></button></td>
       </tr>
        </table>
    </div></td>
    <td>
            <div id="a" style="width: 500px; height: 500px;float: right;"></div>
</td></table>
    <div id="skill1" style="display: none;">
    <textarea class="skill" readonly='readonly' disabled="disabled" id="1s">
</textarea>
</div> 
<div id="skill2" style="display: none;">
    <textarea class="skill" readonly='readonly' disabled="disabled" id="2s">
</textarea>
</div>
<div id="skill3" style="display: none;">
    <textarea class="skill"readonly='readonly' disabled="disabled" id="3s">
</textarea>
</div>  
<div id="skill4" style="display: none;">
    <textarea class="skill" readonly='readonly' disabled="disabled" id="4s">
</textarea>
</div> 
<button type="button" id="ban" onclick="banpick()" style="display: none">禁用</button>
</div>
</body>
<script type="text/javascript">
    var ordernum=1;
    var picknum=0;
    var num1=0;
    var hero=new Array(4);
    hero[0]=0;hero[1]=0;hero[2]=0;hero[3]=0;
    document.getElementById("head").src="./head/"+num1+".jpg"
    var attack=new Array(10);
    attack[0]=1;attack[1]=1;attack[2]=0.8;attack[3]=0.4;attack[4]=0.8;attack[5]=0.1;attack[6]=0.1;attack[7]=0.9;attack[8]=0.9;attack[9]=0.1;attack[10]=0.9;attack[11]=1;attack[12]=0.8;attack[13]=1;
    var recover=new Array(10);
    recover[0]=1;recover[1]=0.1;recover[2]=0.8;recover[3]=0.8;recover[4]=0.8;recover[5]=1;recover[6]=1;recover[7]=0.8;recover[8]=0.8;recover[9]=0.1;recover[10]=0.9;recover[11]=1;recover[12]=0.8;recover[13]=0.6;
    var dominate=new Array(10);
    dominate[0]=1;dominate[1]=0.1;dominate[2]=0.2;dominate[3]=1;dominate[4]=0.1;dominate[5]=0.1;dominate[6]=0.6;dominate[7]=0.1;dominate[8]=0.1;dominate[9]=0.1;dominate[10]=1;dominate[11]=0.1;dominate[12]=1;dominate[13]=0.1;
    var rare=new Array(10);
    rare[0]=1;rare[1]=0.6;rare[2]=0.6;rare[3]=0.6;rare[4]=0.6;rare[5]=0.6;rare[6]=0.6;rare[7]=0.6;rare[8]=0.6;rare[9]=0.6;rare[10]=0.8;rare[11]=0.8;rare[12]=0.8;rare[13]=0.8;
    var place=new Array(10);
    place[0]=1;place[1]=0.6;place[2]=0.9;place[3]=0.6;place[4]=0.6;place[5]=0.6;place[6]=0.6;place[7]=0.6;place[8]=0.6;place[9]=1;place[10]=0.6;place[11]=1;place[12]=0.8;place[13]=0.6;
    var tim=new Array(10);
    tim[0]=1;tim[1]=0.8;tim[2]=0.7;tim[3]=1;tim[4]=0.8;tim[5]=1;tim[6]=0.8;tim[7]=0.8;tim[8]=0.8;tim[9]=0.6;tim[10]=0.9;tim[11]=0.8;tim[12]=0.9;tim[13]=1;
function show(button)
{
    document.getElementById("ban").style.display="block"
    num1=button.value;
    document.getElementById("head").src="./head/"+num1+".jpg"
    echart1(num1)
    if (num1==1)
    {
        document.getElementById("1s").value="选择一名玩家失去与当前回合数有关的财产"
        document.getElementById("2s").value="该角色无七武海觉醒技"
        document.getElementById("3s").value="选择一名玩家失去随机1-6*300的财产"
        document.getElementById("4s").value="该角色无四皇觉醒技"
    }
    else if (num1==2)
    {
        document.getElementById("1s").value="其他玩家失去当前财产6%的财产"
        document.getElementById("2s").value="该角色无七武海觉醒技"
        document.getElementById("3s").value="进行一次判定，若为红色，则获得其名下地产数*400的财产"
        document.getElementById("4s").value="该角色无四皇觉醒技"
    }
        else if (num1==3)
    {
        document.getElementById("1s").value="进行一次判定，若成功，则选择一名玩家休息1天"
        document.getElementById("2s").value="该角色无七武海觉醒技"
        document.getElementById("3s").value="获得场上剩余玩家数*400的财产"
        document.getElementById("4s").value="该角色无四皇觉醒技"
    }
        else if (num1==4)
    {
        document.getElementById("1s").value="获得其他玩家的400分"
        document.getElementById("2s").value="该角色无七武海觉醒技"
        document.getElementById("3s").value="进行一次判定，若成功，则可获得其他玩家的2%"
        document.getElementById("4s").value="该角色无四皇觉醒技"
    }
        else if (num1==5)
    {
        document.getElementById("1s").value="获得300分"
        document.getElementById("2s").value="该角色无七武海觉醒技"
        document.getElementById("3s").value="若当前财产少于30000,则获得当前财产与30000差额的6%"
        document.getElementById("4s").value="该角色无四皇觉醒技"
    }
        else if (num1==6)
    {
        document.getElementById("1s").value="选择一名玩家，解除其禁锢状态并回复与禁锢天数相关的财产，若该玩家未被禁锢则使其恢复2%的财产"
        document.getElementById("2s").value="该角色无七武海觉醒技"
        document.getElementById("3s").value="恢复自身1%的财产"
        document.getElementById("4s").value="该角色无四皇觉醒技"
    }
        else if (num1==7)
    {
        document.getElementById("1s").value="使得全场玩家失去当前财产10%的财产"
        document.getElementById("2s").value="该角色无七武海觉醒技"
        document.getElementById("3s").value="获得500分"
        document.getElementById("4s").value="该角色无四皇觉醒技"
    }
        else if (num1==8)
    {
        document.getElementById("1s").value="获得2000分"
        document.getElementById("2s").value="该角色无七武海觉醒技"
        document.getElementById("3s").value="若自身财产多于20000分，则自身财产变为20000，对全场玩家造成减少财产数额50%的伤害"
        document.getElementById("4s").value="该角色无四皇觉醒技"
    }
        else if (num1==9)
    {
        document.getElementById("1s").value="失去500分"
        document.getElementById("2s").value="该角色无七武海觉醒技"
        document.getElementById("3s").value="进行一次判定，若成功，则名下所有地产升级，同时获得地产数*500的财产"
        document.getElementById("4s").value="该角色无四皇觉醒技"
    }
        else if (num1==10)
    {
        document.getElementById("1s").value="获得1000分"
        document.getElementById("2s").value="进行一次判定，若成功，则其余玩家失去一回合行动力"
        document.getElementById("3s").value="使得全场玩家失去1000分"
        document.getElementById("4s").value="该角色无四皇觉醒技"
    }
    else if (num1==11)
    {
        document.getElementById("1s").value="获得不在其名下的地产数*150的财产"
        document.getElementById("2s").value="进入两回合休眠,同时失去30%财产"
        document.getElementById("3s").value="进行一次判定，若成功使得其余玩家失去2000分"
        document.getElementById("4s").value="该角色无四皇觉醒技"
    }
    else if (num1==12)
    {
        document.getElementById("1s").value="每回合获得当前财产数10%的财产"
        document.getElementById("2s").value="每回合可选择一名玩家强行使其向前移动随机1-6格数并扣除结束移动时所在非官方地产的当前费用"
        document.getElementById("3s").value="每回合可选择向前移动至多3格,每多行一格失去200分";
        document.getElementById("4s").value="该角色无四皇觉醒技"
    }
    else if (num1==13)
    {
        document.getElementById("1s").value="每回合对全场玩家造成当前回合数*10+500分的伤害"
        document.getElementById("2s").value="每回合可选择一名玩家释放其某个特定技能"
        document.getElementById("3s").value="回合开始时若财产数少于500分,全场玩家失去20000分"
        document.getElementById("4s").value="该角色无四皇觉醒技";
    }

}
function GetQueryString(name)
{
     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
     var r = window.location.search.substr(1).match(reg);
     if(r!=null)return  decodeURIComponent(r[2]); return null;
}
    function isHidden(oDiv){
        var vDiv=document.getElementById(oDiv);
    vDiv.style.display = (vDiv.style.display == 'block')?'none':'block';
    }
function banpick()
{
    var ban=document.getElementById("ban").innerHTML;
    if (ban=='选择')
       {    
            hero[picknum]=num1;
            document.getElementById(num1).style.display="none"
            picknum++;
        num1=0;
        document.getElementById("head").src="./head/"+num1+".jpg"
        echart1(num1)

       }
    else{
        document.getElementById(num1).style.display="none"
        num1=0;
        document.getElementById("head").src="./head/"+num1+".jpg"
        echart1(num1)
    } 
        ordernum++;
    if (ordernum==3||ordernum==4||ordernum==7||ordernum==8)
    {
        document.getElementById("ban").innerHTML="选择"
    }
    else
    {
        document.getElementById("ban").innerHTML="禁用"

    }
    if (ordernum==9)
        window.location.href=`C:/Users/Dell/Desktop/Thepoorplus/code/gamecode/public/index.html?num1=${hero[0]}&num2=${hero[1]}&num3=${hero[2]}&num4=${hero[3]}`


}
function echart1(num1){
    var myChart1 = echarts.init(document.getElementById('a'))
    option1 = {
        title: {
            text: "数据雷达图",
            textStyle:{
                color:'#fff'
            }
        },
        tooltip: {},
       
        radar: [{
            //这是雷达图的大小
            radius:'50%',
            //图外名称
            name:{
                formatter:'{value}',
                // 字体样式
                textStyle:{
                    fontSize:14,
                    color:'#fff'
                }
            },
            indicator: [{
                name: "伤害",
                max:1
            }, {
                name: "续航",
                max: 1
            }, {
                name: "控制",
                max: 1
            }, {
                name: "稀有",
                max: 1
            }, {
                name: "地产",
                max: 1
            }, {
                name: "时效",
                max: 1
            }],
            //文字与图的距离
            nameGap: 20,
            //坐标轴线的设置
            axisLine: {
                show: true,
                lineStyle:{
                    color:'#FFF',

                },
                
            },
            //指示器轴的分割段数
            splitNumber: 5,
            axisTick: {
                color:'#365079',
                
            },
            axisLabel: {},
            splitLine: {
                lineStyle: {
                    shadowBlur: 15,
                    shadowColor: null
                }
            },
            //分割区域是否显示
            splitArea: {
                //分割区域的样式
                areaStyle:{
                    color: ['#fff', '#fff', '#fff', '#c3c3c3','#1F345E'],
                    shadowColor: 'rgba(0, 100, 0, 0.3)',
                    opacity: 0.2,
                }
            }
        }],
        series: [{
            name: "数据雷达图",
            type: "radar",
            data: [{
                value: [attack[num1], recover[num1], dominate[num1], rare[num1], place[num1], tim[num1]],
                name: "数据雷达图",
                itemStyle: { // 单个拐点标志的样式设置。
                normal: {
                    borderColor: '#FFB9B0',
                    // 拐点的描边颜色。[ default: '#000' ]
                    borderWidth: 4,
                    // 拐点的描边宽度，默认不描边。[ default: 0 ]
                }
            },
            lineStyle: { // 单项线条样式。
                normal: {
                    opacity: 0.5 // 图形透明度
                }
            },
            areaStyle: { // 单项区域填充样式
                normal: {
                    // color: 'red', // 填充的颜色。[ default: "#000" ]
                    //不透明
                    opacity:0.5,
                    //数据阴影
                    shadowColor:'#2c3F56',
                    // 阴影长度
                    shadowBlur:3,
                    // 阴影偏移
                    shadowOffsetY:2,
                    shadowoffsetX:5,
                    //填充区域颜色渐变
                    color: new echarts.graphic.LinearGradient(
                    0, 0, 1, 1,
                    [
                        // 柱子0%的颜色
                        {offset: 0, color: '#fff'},
                        //柱子50%的颜色
                        {offset: 0.5, color: '#fff'},
                        //柱子100%的颜色
                        {offset: 1, color: '#fff'}
                    ]
                )
                }
            }
             }],
            itemStyle: { // 折线拐点标志的样式。
                normal: { // 普通状态时的样式
                    lineStyle: {
                        width:0
                    },
                    opacity: 0.3
                },
                emphasis: { // 高亮时的样式
                lineStyle: {
                },
                opacity: 1
            }
            },
        }]
    }
myChart1.setOption(option1)
}
    echart1(num1)
</script>
<script>
function initVars(){

    pi=Math.PI;
    ctx=canvas.getContext("2d");
    canvas.width=canvas.clientWidth;
    canvas.height=canvas.clientHeight;
    cx=canvas.width/2;
    cy=canvas.height/2;
    playerZ=-25;
    playerX=playerY=playerVX=playerVY=playerVZ=pitch=yaw=pitchV=yawV=0;
    scale=600;
    seedTimer=0;seedInterval=5,seedLife=100;gravity=.02;
    seeds=new Array();
    sparkPics=new Array();
    s="https://cantelope.org/NYE/";
    for(i=1;i<=10;++i){
        sparkPic=new Image();
        sparkPic.src=s+"spark"+i+".png";
        sparkPics.push(sparkPic);
    }
    sparks=new Array();
    pow1=new Audio(s+"pow1.ogg");
    pow2=new Audio(s+"pow2.ogg");
    pow3=new Audio(s+"pow3.ogg");
    pow4=new Audio(s+"pow4.ogg");
    frames = 0;
}

function rasterizePoint(x,y,z){

    var p,d;
    x-=playerX;
    y-=playerY;
    z-=playerZ;
    p=Math.atan2(x,z);
    d=Math.sqrt(x*x+z*z);
    x=Math.sin(p-yaw)*d;
    z=Math.cos(p-yaw)*d;
    p=Math.atan2(y,z);
    d=Math.sqrt(y*y+z*z);
    y=Math.sin(p-pitch)*d;
    z=Math.cos(p-pitch)*d;
    var rx1=-1000,ry1=1,rx2=1000,ry2=1,rx3=0,ry3=0,rx4=x,ry4=z,uc=(ry4-ry3)*(rx2-rx1)-(rx4-rx3)*(ry2-ry1);
    if(!uc) return {x:0,y:0,d:-1};
    var ua=((rx4-rx3)*(ry1-ry3)-(ry4-ry3)*(rx1-rx3))/uc;
    var ub=((rx2-rx1)*(ry1-ry3)-(ry2-ry1)*(rx1-rx3))/uc;
    if(!z)z=.000000001;
    if(ua>0&&ua<1&&ub>0&&ub<1){
        return {
            x:cx+(rx1+ua*(rx2-rx1))*scale,
            y:cy+y/z*scale,
            d:Math.sqrt(x*x+y*y+z*z)
        };
    }else{
        return {
            x:cx+(rx1+ua*(rx2-rx1))*scale,
            y:cy+y/z*scale,
            d:-1
        };
    }
}

function spawnSeed(){
    
    seed=new Object();
    seed.x=-50+Math.random()*100;
    seed.y=25;
    seed.z=-50+Math.random()*100;
    seed.vx=.1-Math.random()*.2;
    seed.vy=-1.5;//*(1+Math.random()/2);
    seed.vz=.1-Math.random()*.2;
    seed.born=frames;
    seeds.push(seed);
}

function splode(x,y,z){
    
    t=5+parseInt(Math.random()*150);
    sparkV=1+Math.random()*2.5;
    type=parseInt(Math.random()*3);
    switch(type){
        case 0:
            pic1=parseInt(Math.random()*10);
            break;
        case 1:
            pic1=parseInt(Math.random()*10);
            do{ pic2=parseInt(Math.random()*10); }while(pic2==pic1);
            break;
        case 2:
            pic1=parseInt(Math.random()*10);
            do{ pic2=parseInt(Math.random()*10); }while(pic2==pic1);
            do{ pic3=parseInt(Math.random()*10); }while(pic3==pic1 || pic3==pic2);
            break;
    }
    for(m=1;m<t;++m){
        spark=new Object();
        spark.x=x; spark.y=y; spark.z=z;
        p1=pi*2*Math.random();
        p2=pi*Math.random();
        v=sparkV*(1+Math.random()/6)
        spark.vx=Math.sin(p1)*Math.sin(p2)*v;
        spark.vz=Math.cos(p1)*Math.sin(p2)*v;
        spark.vy=Math.cos(p2)*v;
        switch(type){
            case 0: spark.img=sparkPics[pic1]; break;
            case 1:
                spark.img=sparkPics[parseInt(Math.random()*2)?pic1:pic2];
                break;
            case 2:
                switch(parseInt(Math.random()*3)){
                    case 0: spark.img=sparkPics[pic1]; break;
                    case 1: spark.img=sparkPics[pic2]; break;
                    case 2: spark.img=sparkPics[pic3]; break;
                }
                break;
        }
        spark.radius=25+Math.random()*50;
        spark.alpha=1;
        spark.trail=new Array();
        sparks.push(spark);
    }
    switch(parseInt(Math.random()*4)){
        case 0: pow=new Audio(s+"pow1.ogg"); break;
        case 1: pow=new Audio(s+"pow2.ogg"); break;
        case 2: pow=new Audio(s+"pow3.ogg"); break;
        case 3: pow=new Audio(s+"pow4.ogg"); break;
    }
    d=Math.sqrt((x-playerX)*(x-playerX)+(y-playerY)*(y-playerY)+(z-playerZ)*(z-playerZ));
    pow.volume=1.5/(1+d/10);
    pow.play();
}

function doLogic(){
    
    if(seedTimer<frames){
        seedTimer=frames+seedInterval*Math.random()*10;
        spawnSeed();
    }
    for(i=0;i<seeds.length;++i){
        seeds[i].vy+=gravity;
        seeds[i].x+=seeds[i].vx;
        seeds[i].y+=seeds[i].vy;
        seeds[i].z+=seeds[i].vz;
        if(frames-seeds[i].born>seedLife){
            splode(seeds[i].x,seeds[i].y,seeds[i].z);
            seeds.splice(i,1);
        }
    }
    for(i=0;i<sparks.length;++i){
        if(sparks[i].alpha>0 && sparks[i].radius>5){
            sparks[i].alpha-=.01;
            sparks[i].radius/=1.02;
            sparks[i].vy+=gravity;
            point=new Object();
            point.x=sparks[i].x;
            point.y=sparks[i].y;
            point.z=sparks[i].z;
            if(sparks[i].trail.length){
                x=sparks[i].trail[sparks[i].trail.length-1].x;
                y=sparks[i].trail[sparks[i].trail.length-1].y;
                z=sparks[i].trail[sparks[i].trail.length-1].z;
                d=((point.x-x)*(point.x-x)+(point.y-y)*(point.y-y)+(point.z-z)*(point.z-z));
                if(d>9){
                    sparks[i].trail.push(point);
                }
            }else{
                sparks[i].trail.push(point);
            }
            if(sparks[i].trail.length>5)sparks[i].trail.splice(0,1);                
            sparks[i].x+=sparks[i].vx;
            sparks[i].y+=sparks[i].vy;
            sparks[i].z+=sparks[i].vz;
            sparks[i].vx/=1.075;
            sparks[i].vy/=1.075;
            sparks[i].vz/=1.075;
        }else{
            sparks.splice(i,1);
        }
    }
    p=Math.atan2(playerX,playerZ);
    d=Math.sqrt(playerX*playerX+playerZ*playerZ);
    d+=Math.sin(frames/80)/1.25;
    t=Math.sin(frames/200)/40;
    playerX=Math.sin(p+t)*d;
    playerZ=Math.cos(p+t)*d;
    yaw=pi+p+t;
}

function rgb(col){
    
    var r = parseInt((.5+Math.sin(col)*.5)*16);
    var g = parseInt((.5+Math.cos(col)*.5)*16);
    var b = parseInt((.5-Math.sin(col)*.5)*16);
    return "#"+r.toString(16)+g.toString(16)+b.toString(16);
}

function draw(){
    
    ctx.clearRect(0,0,cx*2,cy*2);
    
    ctx.fillStyle="#ff8";
    for(i=-100;i<100;i+=3){
        for(j=-100;j<100;j+=4){
            x=i;z=j;y=25;
            point=rasterizePoint(x,y,z);
            if(point.d!=-1){
                size=250/(1+point.d);
                d = Math.sqrt(x * x + z * z);
                a = 0.75 - Math.pow(d / 100, 6) * 0.75;
                if(a>0){
                    ctx.globalAlpha = a;
                    ctx.fillRect(point.x-size/2,point.y-size/2,size,size);              
                }
            }
        }
    }
    ctx.globalAlpha=1;
    for(i=0;i<seeds.length;++i){
        point=rasterizePoint(seeds[i].x,seeds[i].y,seeds[i].z);
        if(point.d!=-1){
            size=200/(1+point.d);
            ctx.fillRect(point.x-size/2,point.y-size/2,size,size);
        }
    }
    point1=new Object();
    for(i=0;i<sparks.length;++i){
        point=rasterizePoint(sparks[i].x,sparks[i].y,sparks[i].z);
        if(point.d!=-1){
            size=sparks[i].radius*200/(1+point.d);
            if(sparks[i].alpha<0)sparks[i].alpha=0;
            if(sparks[i].trail.length){
                point1.x=point.x;
                point1.y=point.y;
                switch(sparks[i].img){
                    case sparkPics[0]:ctx.strokeStyle="#f84";break;
                    case sparkPics[1]:ctx.strokeStyle="#84f";break;
                    case sparkPics[2]:ctx.strokeStyle="#8ff";break;
                    case sparkPics[3]:ctx.strokeStyle="#fff";break;
                    case sparkPics[4]:ctx.strokeStyle="#4f8";break;
                    case sparkPics[5]:ctx.strokeStyle="#f44";break;
                    case sparkPics[6]:ctx.strokeStyle="#f84";break;
                    case sparkPics[7]:ctx.strokeStyle="#84f";break;
                    case sparkPics[8]:ctx.strokeStyle="#fff";break;
                    case sparkPics[9]:ctx.strokeStyle="#44f";break;
                }
                for(j=sparks[i].trail.length-1;j>=0;--j){
                    point2=rasterizePoint(sparks[i].trail[j].x,sparks[i].trail[j].y,sparks[i].trail[j].z);
                    if(point2.d!=-1){
                        ctx.globalAlpha=j/sparks[i].trail.length*sparks[i].alpha/2;
                        ctx.beginPath();
                        ctx.moveTo(point1.x,point1.y);
                        ctx.lineWidth=1+sparks[i].radius*10/(sparks[i].trail.length-j)/(1+point2.d);
                        ctx.lineTo(point2.x,point2.y);
                        ctx.stroke();
                        point1.x=point2.x;
                        point1.y=point2.y;
                    }
                }
            }
            ctx.globalAlpha=sparks[i].alpha;
            ctx.drawImage(sparks[i].img,point.x-size/2,point.y-size/2,size,size);
        }
    }
}

function frame(){

    if(frames>100000){
        seedTimer=0;
        frames=0;
    }
    frames++;
    draw();
    doLogic();
    requestAnimationFrame(frame);
}

window.addEventListener("resize",()=>{
    canvas.width=canvas.clientWidth;
    canvas.height=canvas.clientHeight;
    cx=canvas.width/2;
    cy=canvas.height/2;
});

initVars();
frame();
</script>
</html>